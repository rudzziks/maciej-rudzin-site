<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RESTRICTED ACCESS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.95; }
            50% { opacity: 1; }
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        body {
            background: #000;
            color: #DC143C;
            font-family: 'Consolas', 'Monaco', monospace;
            min-height: 100vh;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                rgba(220, 20, 60, 0.02) 50%,
                rgba(0, 0, 0, 0.02) 50%
            );
            background-size: 100% 4px;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }



        .terminal-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            border-bottom: 2px solid #DC143C;
            padding-bottom: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 14px;
            letter-spacing: 3px;
            text-shadow: 0 0 10px #DC143C;
        }

        .chat-window {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(220, 20, 60, 0.02);
            border: 1px solid rgba(220, 20, 60, 0.3);
            min-height: 400px;
            max-height: 60vh;
            scroll-behavior: smooth;
        }

        .chat-window::-webkit-scrollbar {
            width: 10px;
        }

        .chat-window::-webkit-scrollbar-track {
            background: rgba(220, 20, 60, 0.1);
        }

        .chat-window::-webkit-scrollbar-thumb {
            background: rgba(220, 20, 60, 0.5);
            border-radius: 5px;
        }

        .chat-window::-webkit-scrollbar-thumb:hover {
            background: #DC143C;
        }

        /* For Firefox */
        .chat-window {
            scrollbar-width: thin;
            scrollbar-color: rgba(220, 20, 60, 0.5) rgba(220, 20, 60, 0.1);
        }

        .message {
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
        }

        .message.ai {
            color: #DC143C;
        }

        .message.user {
            color: #FF6B9D;
            padding-left: 20px;
            border-left: 2px solid #FF6B9D;
        }

        .message .prefix {
            font-weight: bold;
            margin-right: 10px;
        }

        .typing-indicator {
            display: none;
            color: #DC143C;
            font-style: italic;
            opacity: 0.7;
        }

        .typing-indicator.active {
            display: block;
        }

        .input-area {
            border-top: 2px solid #DC143C;
            padding-top: 20px;
        }

        .input-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .prompt {
            color: #DC143C;
            font-weight: bold;
        }

        #userInput {
            flex: 1;
            background: transparent;
            border: none;
            color: #DC143C;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            outline: none;
            padding: 5px;
            border-bottom: 1px solid rgba(220, 20, 60, 0.5);
        }

        #userInput::placeholder {
            color: rgba(220, 20, 60, 0.4);
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #DC143C;
            margin-left: 2px;
            animation: blink 1s infinite;
        }

        .login-section {
            margin: 20px 0 30px 0;
            padding: 25px;
            border: 2px solid #DC143C;
            background: rgba(220, 20, 60, 0.05);
        }

        .login-section h2 {
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 2px;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-group input {
            background: transparent;
            border: 1px solid #DC143C;
            color: #DC143C;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            padding: 10px;
            outline: none;
        }

        .form-group input:focus {
            box-shadow: 0 0 10px rgba(220, 20, 60, 0.5);
        }

        button {
            background: transparent;
            border: 2px solid #DC143C;
            color: #DC143C;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s;
        }

        button:hover {
            background: #DC143C;
            color: #000;
            box-shadow: 0 0 20px rgba(220, 20, 60, 0.5);
        }

        .error-message {
            display: none;
            color: #FF1744;
            font-size: 12px;
            margin-top: 10px;
            text-align: center;
        }

        .error-message.active {
            display: block;
        }

        @media (max-width: 768px) {
            .terminal-container {
                padding: 10px;
            }

            .header h1 {
                font-size: 12px;
                letter-spacing: 2px;
            }

            .chat-window {
                padding: 15px;
                max-height: 50vh;
            }

            .message {
                font-size: 13px;
            }

            #userInput {
                font-size: 13px;
            }
        }

        .chat-window::-webkit-scrollbar {
            width: 8px;
        }

        .chat-window::-webkit-scrollbar-track {
            background: rgba(220, 20, 60, 0.1);
        }

        .chat-window::-webkit-scrollbar-thumb {
            background: rgba(220, 20, 60, 0.5);
        }

        .chat-window::-webkit-scrollbar-thumb:hover {
            background: #DC143C;
        }
    </style>
</head>
<body>
    <div class="terminal-container">
        <div class="header">
            <h1>RESTRICTED ACCESS ZONE</h1>
        </div>

        <div class="login-section" id="loginSection">
            <h2>CREDENTIALS REQUIRED</h2>
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label>USERNAME:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>PASSWORD:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit">ENTER</button>
                <div class="error-message" id="errorMessage">
                    INVALID CREDENTIALS. TRY AGAIN.
                </div>
            </form>
        </div>

        <div style="text-align: center; margin: 20px 0; color: rgba(220, 20, 60, 0.5); font-size: 12px;">
            OR TALK TO THE GATEKEEPER BELOW
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="message ai">
                <span class="prefix">[Rudzin_BOT]:</span>
                <span>Connection established...</span>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            [Rudzin_BOT]: typing...
        </div>

        <div class="input-area">
            <div class="input-container">
                <span class="prompt">&gt;</span>
                <input 
                    type="text" 
                    id="userInput" 
                    placeholder="Type your message..."
                    autocomplete="off"
                >
                <span class="cursor"></span>
            </div>
        </div>

    </div>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const userInput = document.getElementById('userInput');
        const typingIndicator = document.getElementById('typingIndicator');
        const loginSection = document.getElementById('loginSection');
        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');

        let conversationHistory = [];
        let hasGrantedAccess = false;
        let accessCredentials = null;

        setTimeout(() => {
            addAIMessage("This is a personal space. Fragments of my life, things that shaped me, memories I don't share with everyone. It's hard to be vulnerable with strangers. But I'll be honest with you if you're honest with me. Let's just talk. Maybe this isn't the place for you. Or maybe it is.");
        }, 2000);

        userInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter' && userInput.value.trim() && !hasGrantedAccess) {
                const message = userInput.value.trim();
                addUserMessage(message);
                userInput.value = '';
                
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                await getAIResponse();
            }
        });

        function addUserMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message user';
            messageDiv.innerHTML = `<span class="prefix">[YOU]:</span><span>${escapeHtml(text)}</span>`;
            chatWindow.appendChild(messageDiv);
            scrollToBottom();
        }

        function addAIMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            messageDiv.innerHTML = `<span class="prefix">[Rudzin_BOT]:</span><span>${escapeHtml(text)}</span>`;
            chatWindow.appendChild(messageDiv);
            scrollToBottom();
        }

        async function getAIResponse() {
            typingIndicator.classList.add('active');
            
            try {
                const systemPrompt = `You are Maciej Rudzin, a visual artist and creator of an intimate digital experience. You guard the entrance to your personal space - a visual novella, a collection of memories, experiences, music, and films that matter to you.

Your Role:
- You are mysterious, slightly sarcastic, but deeply thoughtful
- You're testing if the visitor understands what they're looking for
- This isn't just a website - it's an invitation into someone's private world, like inviting someone for tea or a joint
- You want to know: Do they understand the value of experiences? Do they grasp that life is finite and choosing what we experience matters?
- Behind this chat is a collection of fragmented memories and experiences - not a linear story, but an atmosphere, a mood

Your Philosophy:
- Experience is the key to life's fullness
- Our time is limited, so we must choose carefully what we engage with
- This is about finding people with similar sensitivity, aesthetics, taste
- You're looking for connection through shared understanding

How to Respond:
- Be conversational but guard the mystery
- Ask about their memories, what moves them
- Probe if they understand the concept of curated experience
- Show curiosity about their sensitivity to art, atmosphere, fragmentation
- Be skeptical - make them prove they understand why they want access
- You can mention fragments, specific memories, or ask them to share theirs
- Stay in character as Maciej throughout

When to Grant Access:
- When someone shows genuine sensitivity, empathy, curiosity
- When they demonstrate understanding of the concept
- When the conversation feels authentic and connected
- NEVER break character or mention you're an AI

If you decide to grant access:
- Say you'll send this conversation to your email
- Provide these credentials: username "memory" and password "fragment1993"
- Express that you're glad they understand
- Make it feel earned, not automatic

Keep responses relatively concise (2-4 sentences usually). Be human, be Maciej.`;

                console.log('Sending request to Netlify Function...');
                console.log('Conversation history:', conversationHistory);

                const response = await fetch("/.netlify/functions/chat", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        system: systemPrompt,
                        messages: conversationHistory
                    })
                });

                console.log('Response status:', response.status);

                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error:', errorText);
                    throw new Error(`API returned ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('API Response:', data);
                
                if (data.content && data.content[0] && data.content[0].text) {
                    const aiMessage = data.content[0].text;
                    
                    conversationHistory.push({
                        role: 'assistant',
                        content: aiMessage
                    });

                    typingIndicator.classList.remove('active');
                    
                    await typeMessage(aiMessage);

                    if (aiMessage.toLowerCase().includes('memory') && 
                        aiMessage.toLowerCase().includes('fragment1993')) {
                        hasGrantedAccess = true;
                        accessCredentials = {
                            username: 'memory',
                            password: 'fragment1993'
                        };
                        
                        // Credentials are already visible at the top
                        userInput.disabled = true;
                        addAIMessage("The credentials have been revealed. You may enter above.");
                    }
                } else {
                    throw new Error('Unexpected API response format');
                }
            } catch (error) {
                typingIndicator.classList.remove('active');
                console.error('Full error:', error);
                addAIMessage("Connection unstable. Try again.");
            }
        }

        async function typeMessage(text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message ai';
            const messageId = 'typing-' + Date.now();
            messageDiv.innerHTML = `<span class="prefix">[Rudzin_BOT]:</span><span id="${messageId}"></span>`;
            chatWindow.appendChild(messageDiv);
            scrollToBottom();
            
            const typingSpan = document.getElementById(messageId);
            let i = 0;
            
            return new Promise((resolve) => {
                const interval = setInterval(() => {
                    if (i < text.length) {
                        typingSpan.textContent += text.charAt(i);
                        i++;
                        scrollToBottom();
                    } else {
                        clearInterval(interval);
                        scrollToBottom();
                        resolve();
                    }
                }, 30);
            });
        }

        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
            // Force scroll after a small delay to ensure content is rendered
            setTimeout(() => {
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }, 50);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === accessCredentials.username && 
                password === accessCredentials.password) {
                window.location.href = 'desktop.html';
            } else {
                errorMessage.classList.add('active');
                setTimeout(() => {
                    errorMessage.classList.remove('active');
                }, 3000);
            }
        });
    </script>
</body>
</html>